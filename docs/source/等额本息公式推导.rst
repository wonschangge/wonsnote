等额本息相关公式推导
====================

设贷款总金额=P，月利率=β，贷款期数为k，月供（本金+利息）为x

等额本息月供x
-----------------

1. 第1期还款后，欠款总金额 Q1 = P * (1 + β) - x
2. 第2期还款后，欠款总金额 Q2 = Q1 * (1 + β) - x 

   - = (P * (1 + β) - x) * (1 + β) - x 
   - = P * (1 + β) ^ 2 - [1 + (1 + β)] * x

3. 第3期还款后，欠款总金额 Q3 = Q2 * (1 + β) - x 

   - = (P * (1 + β) ^ 2 - [1 + (1 + β)] * x) * (1 + β) - x 
   - = P * (1 + β) ^ 3 - [1 + (1 + β) + (1 + β) ^ 2] * x

4. 第k期还款后，欠款总金额 Q(k) = Q(k-1) * (1 + β) - x 

   - = P * (1 + β) ^ k - [1 + (1 + β) + (1 + β) ^ 2 + ... + (1 +  β) ^ (k - 1)] * x

     - 等比数列推导：
     -     Sk = 1 + y + y ^ 2 + .... + y ^ (k-1)
     - y * Sk = y + y + y ^ 2 + .... + y ^ k
     - 相减，(y - 1)Sk = y ^ k - 1，得 Sk = (y ^ k - 1)/(y - 1)
   
   - = P * (1 + β) ^ k - [(y ^ k - 1)/(y - 1)] * x
   - 代入 y = 1 + β
   - = P * (1 + β) ^ k - [((1 + β) ^ k - 1)/(1 + β) - 1] * x
   - = P * (1 + β) ^ k - {[(1 + β) ^ k - 1]/β} * x
   - 假设第n期后结束，则上述变成：
   - 0 = P * (1 + β) ^ n - {[(1 + β) ^ n - 1]/β} * x
   - x = [P * (1 + β) ^ n] / {[(1 + β) ^ n - 1]/β}
   - 化为，x = [P * β * (1 + β) ^ n] / [(1 + β) ^ n - 1]

等额本息本金y
-----------------

1. 第1期还款本金 y1 = x - P * β
2. 第2期还款本金 y2 = x - (P - y1) * β

   - = x - P * β + y1 * β
   - = y1 * (1 + β)

3. 第3期还款本金 y3 = x - (P - y1 - y2) * β

   - = x - (P - y1 - y1 * (1 + β)) * β
   - = x - P * β + y1 * β + y1 * β * (1 + β)
   - = y1 + y1 * β + y1 * β * (1 + β)
   - = y1 * (1 + 2β + β ^ 2)
   - = y1 * (1 + β) ^ 2

4. 第n期还款本金 y(n) = y1 * (1 + β) ^ (n - 1)

首期利息z与末期本金
------------------------

等额本息构成中，首月还款可能存在不足月情况，本金可按上述公式得出，但利息不能按满月算，

https://www.cnblogs.com/hanganglin/p/6777838.html