Linux命令大全
===========================================================

 [shell中的if语句-详细](https://www.cnblogs.com/kaishirenshi/p/9729800.html)

ptgen用法

ptgen是OpenWrt中开发的用于生成 gpt 分区表的工具，类似MBR，支持4个主分区。

用法：

::

    ptgen \
        [-v] [-n] [-g] \
        -h <heads> \
        -s <sectors> \
        -o <outputfile> 
        [-a 0..4] 
        [-l <align kB>] \
        [-G <guid>] \
        [
            [-t <type> | -T <GPT part type>] \
            [-r]
            [-N <name>] 
            -p <size>[@start]...
        ]

选项意义：

- -v: 指定是否打印调试信息,可选  

- -h: 指定起始磁头号  

- -s: 指定起始扇区号  

- -o: 指定输出文件名  

- -a: 指定激活分区为哪个, 可选  

- -l:  指定多少KiB对齐,可选
  
  - 这个参数会决定每个分区的偏移扇区号，非常重要  

- -t:  指定文件系统分区标志类型值
  
  - 常用的: 0x83 代表 linux，0x0b 代表 FAT32（VFAT）
  
  - 具体可通过 fdisk 中的列表可看

- -p  指定分区大小,可选

- -n ignore_null_sized_partition\

- -g 使用GUID分区表（默认使用MBR，分区上限为4）

- -H 混合模式？

- -N name=optarg

- 

示例：

::

    # 可直接测试该 host 二进制工具
    $ ./ptgen -o /tmp/test.img -h 4 -s 63 -l 1024 -t c -p 5M -t 83 -p 32M
    1048576
    5242880
    7340032
    33554432

    # 可看出分区表的大小 512 字节
    $ ls -lh /tmp/test.img 
    -rw-r--r-- 1 lql lql 512 May 19 15:11 /tmp/test.img

    $ hexdump -C /tmp/test.img 
    00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
    *
    000001b0  00 00 00 00 00 00 00 00  4f 57 52 54 00 00 80 00  |........OWRT....|
    000001c0  21 08 0c 03 03 30 00 08  00 00 00 28 00 00 00 03  |!....0.....(....|
    000001d0  24 38 83 03 73 3c 00 38  00 00 00 00 01 00 00 00  |$8..s<.8........|
    000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
    000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
    00000200

ptgen生成的分区中间会有空隙，1M，示意图：

::

    +-------+  
    |       |
    +-------+  1M
    |       |  boot.img(5M)
    +-------+  6M
    |       |  <-------- 1M 的空隙
    +-------+  7M
    |       |  rootfs.img(32M)
    +-------+ 