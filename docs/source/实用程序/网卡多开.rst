网卡多开
============================

SD-WAN 彻底断开了工作时访问非指定域名的可能性，只能访问 SD-WAN
指定的白名单域名。

因此，为了提高生产效率，需要找到合适的方式。

因为 SD-WAN 依然工作在应用层上，所以双网卡方案依然是一个有效的应对方案。

双网卡方案：有线走内网无线走外网
--------------------------------

笔者系统环境：Linux（ubuntu18.04）

主要使用工具：route

硬件支持：要有两张网卡（有线网卡、无线网卡、外置有线网卡、外置无线网卡、蓝牙网卡等），一张访问外网，一张访问内网

具体操作有两步：

第1步. 调整网卡网络使用优先级 第2步. 指定网段走指定网卡网关

第1步.调整网卡网络使用优先级
----------------------------

笔者的网络硬件配置： - 内网网卡 - enp0s31f6 - 外网网卡 - wlp3s0
(走wifi连接数据热点)

这一步的关键是设置网络优先流通的权重。

**metric值越低，网络优先流通的权重越高。**

.. code:: sh

   # 因 SD-WAN 采用白名单机制，因此将外网(此处是wlan网络)优先级置为最高
   # 即大部分的网络流量（所有能连通的网络）将走 wlan 网络，
   # 小部分的网络流量（如内网网络、指定的网络）将走 enp0 网络
   sudo route add default gw 172.20.10.1 dev wlp3s0 metric 99
   sudo route add default gw 192.168.199.1 dev enp0s31f6 metric 100

   # 检查配置
   route -n

..

   默认情况下，有线网卡的 metric 会比无线网卡的更低，即优先级更高。

第2步.指定网段走指定网卡网关
----------------------------

指定内网IP段流通使用有线网卡，按需添加

如果想节省流量，则添加越多的IP段进来就越好（即将SD-WAN里的白名单全都流经内网）

.. code:: sh

   # eg.
   sudo route add -net <内网IP段>/24 gw 172.20.11.253 dev enp0s31f6
   # bing.com
   sudo route add -net 204.79.197.0/24 gw 192.168.199.1 dev enp0s31f6
   # baidu.com
   sudo route add -net 110.242.68.0/24 gw 192.168.199.1 dev enp0s31f6
   # weixin.com
   sudo route add -net 157.255.4.0/24 gw 192.168.199.1 dev enp0s31f6

验证你的配置是否生效，可以通过在配置之前、配置之后分别 ping
你要访问的域名。

理论上，有线网卡的流量会更稳定，时延更低，笔者这里是这样。